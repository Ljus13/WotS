<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Red Hood Box Generator - Ken-Code</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Vue 3 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- Quill.js (Rich Text Editor) CDN -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
    <link href="css/ken-code.css" rel="stylesheet">

    <style>
        body {
            font-family: 'Niramit', sans-serif;
            background-color: #0c0807; 
            color: #f8fafc;
        }

        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #1a1210; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #5c3c35; border-radius: 4px; }

        input[type="range"] { accent-color: #c75b5b; }

        /* Quill Editor Dark Overrides */
        .ql-toolbar.ql-snow { border-color: #3b2a25; background-color: #1a1210; border-radius: 0.5rem 0.5rem 0 0; }
        .ql-container.ql-snow { border-color: #3b2a25; background-color: #0c0807; border-radius: 0 0 0.5rem 0.5rem; color: #e2e8f0; min-height: 250px; }
        .ql-snow .ql-stroke { stroke: #cbd5e1; }
        .ql-snow .ql-fill { fill: #cbd5e1; }


        /* ====== (Preview helpers moved to css/ken-code.css) ====== */

        .preview-content-box p { margin-bottom: 20px; line-height: 1.8; }
        .preview-content-box em, .preview-content-box i { color: #a89b8c; font-style: italic; }

        /* Toast Animation */
        .toast-enter-active, .toast-leave-active { transition: all 0.3s ease; }
        .toast-enter-from, .toast-leave-to { transform: translateY(20px); opacity: 0; }
    </style>
</head>
<body>


<div id="app" class="h-screen flex flex-col overflow-hidden">
    <!-- Header -->
    <header class="bg-[#1a1210] border-b border-[#3b2a25] p-4 flex justify-between items-center shrink-0 z-20 shadow-lg">
        <div class="flex items-center gap-3">
            <i class="fa-solid fa-moon text-[#c75b5b] text-2xl"></i>
            <h1 class="text-xl font-bold font-['Cinzel'] text-[#c75b5b]">The Red Hood <span class="text-[#f0e6d2]">Generator</span></h1>
        </div>
        <div class="flex items-center gap-4">
            <button @click="promptReset" class="text-xs text-gray-400 hover:text-rose-400 transition-colors border border-[#3b2a25] px-4 py-1.5 rounded-full">
                <i class="fa-solid fa-rotate-right mr-1"></i> รีเซ็ตข้อมูล
            </button>
        </div>
    </header>

    <!-- Main Workspace -->
    <main class="flex-1 flex flex-col lg:flex-row overflow-hidden">
        
        <!-- Left Sidebar: Controls -->
        <aside class="w-full h-1/2 lg:h-full lg:w-[450px] bg-[#140c0a] border-r border-[#3b2a25] flex flex-col shrink-0 overflow-y-auto custom-scrollbar p-6 space-y-6">
            
            <!-- Character Info -->
            <div class="space-y-4">
                <h2 class="text-sm font-bold text-[#c75b5b] uppercase tracking-widest font-['Cinzel'] flex items-center gap-2">
                    <i class="fa-solid fa-user-gear"></i> Character Setup
                </h2>
                <div class="space-y-4 bg-[#1a1210] p-4 rounded-xl border border-[#2e1d18]">
                    <div>
                        <label class="block text-[10px] text-gray-500 mb-1 uppercase tracking-tighter">Character Name</label>
                        <input type="text" v-model="form.name" class="w-full bg-[#0c0807] border border-[#3b2a25] rounded-lg p-2.5 text-[#eaddcf] focus:border-[#c75b5b] outline-none">
                    </div>
                    <div>
                        <label class="block text-[10px] text-gray-500 mb-1 uppercase tracking-tighter">IMAGE URL</label>
                        <input type="text" v-model="form.pic" class="w-full bg-[#0c0807] border border-[#3b2a25] rounded-lg p-2.5 text-[#eaddcf] focus:border-[#c75b5b] outline-none">
                    </div>
                    <div class="space-y-4 p-4 bg-[#0c0807] rounded-lg border border-[#3b2a25]">
                        <div>
                            <label class="flex justify-between text-[10px] text-gray-500 mb-2 uppercase">Image Scale: {{ form.picSz }}%</label>
                            <input type="range" v-model="form.picSz" min="10" max="400" class="w-full">
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-[10px] text-gray-500 mb-2 uppercase text-center">Pos X ซ้ายขวา: {{ form.picPosX }}%</label>
                                <input type="range" v-model="form.picPosX" min="0" max="100" class="w-full">
                            </div>
                            <div>
                                <label class="block text-[10px] text-gray-500 mb-2 uppercase text-center">Pos Y บนล่าง: {{ form.picPosY }}%</label>
                                <input type="range" v-model="form.picPosY" min="0" max="100" class="w-full">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Typography Settings -->
            <div class="space-y-4">
                <h2 class="text-sm font-bold text-[#d4c5b9] uppercase tracking-widest font-['Cinzel'] flex items-center gap-2">
                    <i class="fa-solid fa-font"></i> แบบอักษร
                </h2>
                <div class="space-y-4 bg-[#1a1210] p-4 rounded-xl border border-[#2e1d18]">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-[10px] text-gray-500 mb-1 uppercase tracking-tighter">แบบอักษร</label>
                            <select v-model="form.fontFamily" class="w-full bg-[#0c0807] border border-[#3b2a25] rounded-lg p-2 text-sm text-[#eaddcf] outline-none">
                                <option value="'Niramit', sans-serif">Niramit</option>
                                <option value="'Kanit', sans-serif">Kanit</option>
                                <option value="'Prompt', sans-serif">Prompt</option>
                                <option value="'Sarabun', sans-serif">Sarabun</option>
                                <option value="'Cinzel', serif">Cinzel</option>
                                <option value="'Mitr', sans-serif">Mitr</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-[10px] text-gray-500 mb-1 uppercase tracking-tighter">ขนาดตัวอักษร</label>
                            <div class="flex items-center gap-2">
                                <input type="number" v-model="form.fontSize" class="w-full bg-[#0c0807] border border-[#3b2a25] rounded-lg p-2 text-sm text-[#eaddcf] outline-none">
                                <span class="text-xs text-gray-500">px</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Content Area -->
            <div class="space-y-4">
                <h2 class="text-sm font-bold text-[#d4c5b9] uppercase tracking-widest font-['Cinzel'] flex items-center gap-2">
                    <i class="fa-solid fa-feather-pointed"></i> เนื้อหา
                </h2>
                <div class="bg-[#1a1210] p-4 rounded-xl border border-[#2e1d18] space-y-4">
                    <div id="editor-container"></div>
                    <div>
                        <label class="block text-[10px] text-gray-500 mb-1 uppercase tracking-tighter">หมายเหตุ</label>
                        <input type="text" v-model="form.note" class="w-full bg-[#0c0807] border border-[#3b2a25] rounded-lg p-2.5 text-[#eaddcf] outline-none focus:border-[#c75b5b]" placeholder="หมายเหตุท้ายโรล...">
                    </div>
                </div>
            </div>

            <div class="pt-4">
                <button @click="copyToClipboard" class="w-full bg-[#8b0000] hover:bg-[#a32a2a] text-white font-bold py-4 rounded-xl shadow-lg transition-all active:scale-95 flex items-center justify-center gap-3">
                    <i class="fa-regular fa-copy text-lg"></i>
                    <span>สร้าง & คัดลอกโค้ด</span>
                </button>
            </div>
        </aside>

        <!-- Right Panel: Live Preview Area -->
        <section class="flex-1 bg-[radial-gradient(circle_at_center,#1a0f0c_0%,#050201_100%)] relative overflow-hidden flex flex-col">
            <div id="preview-area-outer" ref="previewAreaRef" class="custom-scrollbar">
                <div id="preview-box-wrapper" :style="wrapperStyle">
                    <div id="preview-inner-container" ref="innerWrapperRef">
                        
                        <!-- THE ROLEPLAY BOX (PREVIEW) -->
                        <div class="ken-redhood26-box" :style="{ fontFamily: form.fontFamily, fontSize: form.fontSize + 'px' }">
                            <div class="ken-redhood26-inner-header">
                                <div class="ken-redhood26-profile-section">
                                    <span class="ken-redhood26-name" :style="{ fontSize: (form.fontSize * 1.8) + 'px' }">{{ form.name }}</span>
                                    <div class="ken-redhood26-avatar-wrapper">
                                        <div class="ken-redhood26-avatar-glow"></div>
                                        <div class="ken-redhood26-avatar" :style="{ background: `url('${form.pic}') ${form.picPosX}% ${form.picPosY}% / ${form.picSz}% no-repeat`, backgroundColor: '#1a1210' }"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="ken-redhood26-glass-panel">
                                <div class="ken-redhood26-content ql-editor" v-html="form.msgHTML"></div>
                                <div v-if="form.note.trim()" class="ken-redhood26-notes">
                                    <div class="ken-redhood26-notes-bg-icon">&ldquo;</div>
                                    <div class="ken-redhood26-notes-inner">
                                        <svg class="ken-redhood26-notes-svg" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                                        <div>
                                            <span class="ken-redhood26-notes-title">หมายเหตุ:</span>
                                            <span class="ken-redhood26-notes-desc" :style="{ fontSize: (form.fontSize * 0.8) + 'px' }">{{ form.note }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <a href="https://discord.com/users/306461697470627840" target="_blank" class="ken-redhood26-credit"></a>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- UI Overlay Components -->
    <Transition name="toast">
        <div v-if="showToast" class="fixed bottom-10 left-1/2 -translate-x-1/2 bg-[#c75b5b] text-white px-8 py-4 rounded-2xl shadow-2xl z-50 flex items-center gap-4 border border-[#8b0000]">
            <i class="fa-solid fa-circle-check text-2xl"></i>
            <div class="flex flex-col">
                <span class="font-bold">คัดลอกสำเร็จ!</span>
                <span class="text-xs opacity-80">โค้ดคัดลอกสำหรับ นำไปวางได้เลย</span>
            </div>
        </div>
    </Transition>
</div>

<script>
    const { createApp, ref, reactive, onMounted, computed, watch } = Vue;

    createApp({
        setup() {
            const STORAGE_KEY = 'ken-redhood-v7-inline-v2';
            const previewAreaRef = ref(null);
            const innerWrapperRef = ref(null);
            const containerWidth = ref(1024);
            const contentHeight = ref(0);
            const showToast = ref(false);
            const showResetModal = ref(false);
            let quill = null;

            const defaultData = {
                pic: 'https://images.unsplash.com/photo-1611601679655-7c8bc197f0c6?auto=format&fit=crop&q=80&w=400&h=400',
                picSz: 100, picPosX: 50, picPosY: 50,
                name: 'เรด (Red)',
                fontFamily: "'Niramit', sans-serif",
                fontSize: 18,
                note: 'โรลเพลย์นี้เป็นแบบ Action/Fantasy นะครับ อนุญาตให้ Join ได้เลยครับ',
                msgHTML: '<p>เสียงย่ำเท้าลงบนใบไม้แห้งดังก้องไปทั่วอาณาบริเวณที่เงียบสงัด...</p><p><br></p><p><em>*เธอหยุดชะงักฝีเท้า ค่อยๆ ลดตะกร้าลง สัญชาตญาณบางอย่างร้องเตือนให้ระวังภัย*</em></p>'
            };

            const form = reactive({ ...defaultData });
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) Object.assign(form, JSON.parse(saved));
            watch(form, (val) => localStorage.setItem(STORAGE_KEY, JSON.stringify(val)), { deep: true });

            const wrapperStyle = computed(() => {
                const targetWidth = 1024;
                const available = containerWidth.value - 40;
                const scale = available < targetWidth ? available / targetWidth : 1;
                return {
                    transform: `scale(${scale})`,
                    height: contentHeight.value > 0 ? (contentHeight.value * scale) + 'px' : 'auto'
                };
            });

            onMounted(() => {
                const updateDimensions = () => {
                    window.requestAnimationFrame(() => {
                        if (previewAreaRef.value) containerWidth.value = previewAreaRef.value.clientWidth;
                        if (innerWrapperRef.value) contentHeight.value = innerWrapperRef.value.offsetHeight;
                    });
                };
                const ro = new ResizeObserver(updateDimensions);
                if (previewAreaRef.value) ro.observe(previewAreaRef.value);
                if (innerWrapperRef.value) ro.observe(innerWrapperRef.value);

                quill = new Quill('#editor-container', {
                    theme: 'snow',
                    modules: { toolbar: [['bold', 'italic', 'underline', 'strike'], [{ 'color': [] }, { 'background': [] }], ['clean']] }
                });
                quill.root.innerHTML = form.msgHTML;
                quill.on('text-change', () => {
                    form.msgHTML = quill.root.innerHTML;
                });
            });

            const copyToClipboard = () => {
                const cssLink = `<link href="https://ljus13.github.io/WotS/css/ken-code.css" rel="stylesheet">`;
                
                // กำหนดสไตล์ชื่อตัวละครแบบ Glass Morphism ผ่าน Inline Style
                const glassEffect = "background:rgba(0,0,0,0.45)!important;backdrop-filter:blur(10px)!important;-webkit-backdrop-filter:blur(10px)!important;border:1px solid rgba(255,255,255,0.1)!important;padding:12px 24px!important;border-radius:12px!important;display:inline-block!important;";
                
                // คำนวณ Inline Style เพื่อล็อคค่าป้องกัน Override
                const boxInline = `font-family:${form.fontFamily}!important;font-size:${form.fontSize}px!important;display:block!important;width:1024px!important;min-width:1024px!important;flex-shrink:0!important;margin:0 auto!important;transform-origin:top center!important;line-height:1.6!important;`;
                const nameInline = `font-size:${form.fontSize * 1.8}px!important;font-family:${form.fontFamily}!important;${glassEffect}`;
                const avatarInline = `background:url('${form.pic}') ${form.picPosX}% ${form.picPosY}% / ${form.picSz}% no-repeat!important;background-color:#1a1210!important;`;
                const noteInline = `font-size:${form.fontSize * 0.8}px!important;font-family:${form.fontFamily}!important;`;
                
                // จัดการ Content - ใส่สไตล์ให้กับ P ทุกตัวผ่านการแทนที่ String
                const styledContent = form.msgHTML.replace(/<p>/g, '<p style="margin-bottom:8px!important;margin-top:0!important;line-height:1.6!important;">');
                
                const notes = form.note.trim() !== '' ? `<div class="ken-redhood26-notes"><div class="ken-redhood26-notes-bg-icon">&ldquo;</div><div class="ken-redhood26-notes-inner"><svg class="ken-redhood26-notes-svg" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg><div><span class="ken-redhood26-notes-title">หมายเหตุ:</span><span class="ken-redhood26-notes-desc" style="${noteInline}">${form.note}</span></div></div></div>` : '';

                const rawHtml = `${cssLink}<div class="ken-redhood26-box" style="${boxInline}"><div class="ken-redhood26-inner-header"><div class="ken-redhood26-profile-section"><span class="ken-redhood26-name" style="${nameInline}">${form.name}</span><div class="ken-redhood26-avatar-wrapper"><div class=\"ken-redhood26-avatar-glow\"></div><div class=\"ken-redhood26-avatar\" style=\"${avatarInline}\"></div></div></div></div><div class=\"ken-redhood26-glass-panel\"><div class=\"ken-redhood26-content ql-editor\">${styledContent}</div>${notes}</div></div><a href=\"https://discord.com/users/306461697470627840\" target=\"_blank\" class=\"ken-redhood26-credit\" style=\"display:block;width:1024px;margin:0 auto;transform-origin:top center;\"></a>`;
                
                const finalCode = rawHtml.replace(/[\r\n]+/g, '').replace(/>\s+</g, '><').trim();
                const el = document.createElement('textarea');
                el.value = finalCode; document.body.appendChild(el); el.select();
                document.execCommand('copy'); document.body.removeChild(el);

                showToast.value = true;
                setTimeout(() => showToast.value = false, 3000);
            };

            return { form, previewAreaRef, innerWrapperRef, wrapperStyle, showToast, showResetModal, copyToClipboard, promptReset: () => { localStorage.removeItem(STORAGE_KEY); window.location.reload(); } };
        }
    }).mount('#app');
</script>
</body>
</html>