<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Red Hood Box Generator (Vue 3 + Quill)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Vue 3 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- Quill.js (Rich Text Editor) CDN -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>

    <!-- ใช้ไฟล์ CSS ท้องถิ่น (เดียวกับ ken-code.css) -->
    <link href="css/ken-code.css" rel="stylesheet">

    <style>
        body {
            font-family: 'Niramit', sans-serif;
            background-color: #0c0807; 
            color: #f8fafc;
        }

        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #1a1210; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #5c3c35; border-radius: 4px; }

        input[type="range"] { accent-color: #c75b5b; }

        /* Quill Editor Dark Overrides */
        .ql-toolbar.ql-snow { border-color: #3b2a25; background-color: #1a1210; border-radius: 0.5rem 0.5rem 0 0; }
        .ql-container.ql-snow { border-color: #3b2a25; background-color: #0c0807; border-radius: 0 0 0.5rem 0.5rem; color: #e2e8f0; min-height: 250px; }
        .ql-snow .ql-stroke { stroke: #cbd5e1; }
        .ql-snow .ql-fill { fill: #cbd5e1; }


        /* ====== (Preview helpers moved to css/ken-code.css) ====== */

        .preview-content-box p { margin-bottom: 20px; line-height: 1.8; }
        .preview-content-box em, .preview-content-box i { color: #a89b8c; font-style: italic; }

        /* Toast Animation */
        .toast-enter-active, .toast-leave-active { transition: all 0.3s ease; }
        .toast-enter-from, .toast-leave-to { transform: translateY(20px); opacity: 0; }
    </style>
</head>
<body>

<div id="app" class="h-screen flex flex-col overflow-hidden">
    <!-- Header -->
    <header class="bg-[#1a1210] border-b border-[#3b2a25] p-4 flex justify-between items-center shrink-0 z-20 shadow-lg">
        <div class="flex items-center gap-3">
            <i class="fa-solid fa-moon text-[#c75b5b] text-2xl"></i>
            <h1 class="text-xl font-bold font-['Cinzel'] text-[#c75b5b]">The Red Hood <span class="text-[#f0e6d2]">Generator</span></h1>
        </div>
        <div class="flex items-center gap-4">
            <button @click="promptReset" class="text-xs text-gray-400 hover:text-rose-400 border border-[#3b2a25] px-4 py-1.5 rounded-full transition-all">
                <i class="fa-solid fa-rotate-right mr-1"></i> รีเซ็ตข้อมูล
            </button>
            <a href="https://discord.com/users/306461697470627840" target="_blank" rel="noopener noreferrer" class="text-xs text-gray-400 hover:text-white underline ml-2">Generator and Code by Kendrick Mervin</a>
        </div>
    </header>

    <!-- Main Workspace -->
    <main class="flex-1 flex flex-col lg:flex-row overflow-hidden">
        
        <!-- Left Sidebar: Controls -->
        <aside class="w-full h-1/2 lg:h-full lg:w-[450px] bg-[#140c0a] border-r border-[#3b2a25] flex flex-col shrink-0">
            <div class="flex-1 overflow-y-auto custom-scrollbar p-6 space-y-8">
                
                <!-- Character Section -->
                <div class="space-y-4">
                    <h2 class="text-sm font-bold text-[#c75b5b] uppercase tracking-widest font-['Cinzel'] flex items-center gap-2">
                        <i class="fa-solid fa-user-gear"></i> การตั้งค่าโค้ดโรลเพลย์
                    </h2>
                    <div class="space-y-4 bg-[#1a1210] p-4 rounded-xl border border-[#2e1d18]">
                        <div>
                            <label class="block text-[10px] text-gray-500 mb-1 uppercase tracking-tighter">ชื่อ</label>
                            <input type="text" v-model="form.name" class="w-full bg-[#0c0807] border border-[#3b2a25] rounded-lg p-2.5 text-[#eaddcf] outline-none focus:border-[#c75b5b]">
                        </div>
                        <div>
                            <label class="block text-[10px] text-gray-500 mb-1 uppercase tracking-tighter">URL รูปภาพ</label>
                            <input type="text" v-model="form.pic" class="w-full bg-[#0c0807] border border-[#3b2a25] rounded-lg p-2.5 text-[#eaddcf] outline-none focus:border-[#c75b5b]">
                        </div>
                        <div class="grid grid-cols-1 gap-4 p-3 bg-[#0c0807] rounded-lg border border-[#3b2a25]">
                            <div>
                                <label class="flex justify-between text-[10px] text-gray-500 mb-2 uppercase">ปรับขนาดรูปโปรไฟล์: {{ form.picSz }}%</label>
                                <input type="range" v-model="form.picSz" min="10" max="400" class="w-full">
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-[10px] text-gray-500 mb-2 uppercase text-center">ตำแหน่ง ซ้าย-ขวา</label>
                                    <input type="range" v-model="form.picPosX" min="0" max="100" class="w-full">
                                </div>
                                <div>
                                    <label class="block text-[10px] text-gray-500 mb-2 uppercase text-center">ตำแหน่ง บน-ล่าง</label>
                                    <input type="range" v-model="form.picPosY" min="0" max="100" class="w-full">
                                </div>
                            </div>
                            <div>
                                <label class="block text-[10px] text-gray-500 mb-2 uppercase">ความกว้างสูงสุดของกล่อง: <span class="font-bold">{{ form.maxWidth }}px</span></label>
                                <input type="range" v-model.number="form.maxWidth" min="1024" max="1250" step="1" class="w-full">
                            </div>
                            <div>
                                <label class="block text-[10px] text-gray-500 mb-2 uppercase">ความสูงขอบบน/ล่าง (edge height): <span class="font-bold">{{ form.edgeHeight }}px</span></label>
                                <input type="range" v-model.number="form.edgeHeight" min="40" max="240" step="1" class="w-full">
                            </div>
                            <div>
                                <label class="block text-[10px] text-gray-500 mb-2 uppercase">ความกว้างขอบซ้าย/ขวา (edge width): <span class="font-bold">{{ form.edgeWidth }}px</span></label>
                                <input type="range" v-model.number="form.edgeWidth" min="40" max="240" step="1" class="w-full">
                            </div>
                            <div>
                                <label class="block text-[10px] text-gray-500 mb-2 uppercase">เลือกฟอนต์</label>
                                <select v-model="form.fontFamily" class="w-full bg-[#0c0807] border border-[#3b2a25] rounded-lg p-2 text-[#eaddcf]">
                                    <option value="'Niramit', sans-serif">Niramit</option>
                                    <option value="'Sarabun', sans-serif">Sarabun</option>
                                    <option value="'Mitr', sans-serif">Mitr</option>
                                    <option value="'Kanit', sans-serif">Kanit</option>
                                    <option value="'Maitree', sans-serif">Maitree</option>
                                </select>
                            </div>
                            <div>
                                <label class="flex justify-between text-[10px] text-gray-500 mb-2 uppercase">ขนาดตัวอักษร: <span class="font-bold">{{ form.fontSize }}px</span></label>
                                <input type="range" v-model.number="form.fontSize" min="12" max="28" step="1" class="w-full">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Content Section -->
                <div class="space-y-4">
                    <h2 class="text-sm font-bold text-[#d4c5b9] uppercase tracking-widest font-['Cinzel'] flex items-center gap-2">
                        <i class="fa-solid fa-feather-pointed"></i>เนื้อหาโรลเพลย์
                    </h2>
                    <div class="bg-[#1a1210] p-4 rounded-xl border border-[#2e1d18] space-y-4">
                        <div id="editor-container"></div>
                        <div>
                            <label class="block text-[10px] text-gray-500 mb-1 uppercase tracking-tighter">หมายเหตุ</label>
                            <input type="text" v-model="form.note" class="w-full bg-[#0c0807] border border-[#3b2a25] rounded-lg p-2.5 text-[#eaddcf] outline-none focus:border-[#c75b5b]" placeholder="หมายเหตุท้ายโรล...">
                        </div>
                    </div>
                </div>

            </div>

            <!-- Footer Action Area -->
            <div class="p-6 border-t border-[#3b2a25] bg-[#0c0807]">
                <button @click="copyToClipboard" class="w-full bg-[#8b0000] hover:bg-[#a32a2a] text-white font-bold py-4 rounded-xl shadow-lg transition-all active:scale-95 flex items-center justify-center gap-3">
                    <i class="fa-regular fa-copy text-lg"></i>
                    <span>COPY CODE</span>
                </button>
            </div>
        </aside>

        <!-- Right Panel: Live Preview Area -->
        <section class="flex-1 bg-[radial-gradient(circle_at_center,#1a0f0c_0%,#050201_100%)] relative overflow-hidden flex flex-col">
            <div class="p-2 text-center text-[10px] text-gray-600 uppercase tracking-[0.3em] z-10 bg-black/20">Live Preview</div>
            
            <div id="preview-area-outer" ref="previewAreaRef" class="custom-scrollbar">
                <div id="preview-box-wrapper" :style="wrapperStyle">
                    <div id="preview-inner-container" ref="innerWrapperRef">
                        
                        <!-- THE ROLEPLAY BOX -->
                        <div class="ken-redhood26-box">
                            <div class="ken-redhood26-inner-header">
                                <div class="ken-redhood26-profile-section">
                                    <span class="ken-redhood26-name">{{ form.name }}</span>
                                    <div class="ken-redhood26-avatar-wrapper">
                                        <div class="ken-redhood26-avatar-glow"></div>
                                        <div class="ken-redhood26-avatar" :style="{ background: `url('${form.pic}') ${form.picPosX}% ${form.picPosY}% / ${form.picSz}% no-repeat`, backgroundColor: '#1a1210' }"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="ken-redhood26-glass-panel">
                                <div class="ken-redhood26-content preview-content-box ql-editor" v-html="form.msgHTML"></div>
                                
                                <div v-if="form.note.trim()" class="ken-redhood26-notes">
                                    <div class="ken-redhood26-notes-bg-icon">&ldquo;</div>
                                    <div class="ken-redhood26-notes-inner">
                                        <svg class="ken-redhood26-notes-svg" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                                        <div>
                                            <span class="ken-redhood26-notes-title">หมายเหตุ:</span>
                                            <span class="ken-redhood26-notes-desc">{{ form.note }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <a href="https://discord.com/users/306461697470627840" target="_blank" class="ken-redhood26-credit"></a>
                        <!-- END -->

                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- UI Overlay Components -->
    <Transition name="toast">
        <div v-if="showToast" class="fixed bottom-10 left-1/2 -translate-x-1/2 bg-[#c75b5b] text-white px-8 py-4 rounded-2xl shadow-2xl z-50 flex items-center gap-4 border border-[#8b0000]">
            <i class="fa-solid fa-circle-check text-2xl"></i>
            <div class="flex flex-col">
                <span class="font-bold font-['Cinzel'] tracking-wider uppercase">ก้อปปี้สำเร็จ!</span>
                <span class="text-xs opacity-80">โค้ดรองรับการแสดงผลบนมือถือ</span>
            </div>
        </div>
    </Transition>

    <div v-if="showResetModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="bg-[#1a1210] border border-[#3b2a25] rounded-3xl p-8 max-w-sm w-full shadow-2xl text-center">
            <h3 class="text-xl font-bold text-white mb-2 font-['Cinzel'] uppercase tracking-widest">Reset?</h3>
            <p class="text-gray-400 text-sm mb-8 leading-relaxed">ข้อมูลทั้งหมดจะถูกรีเซ็ตเป็นค่าเริ่มต้น และไม่สามารถกู้คืนได้</p>
            <div class="flex gap-4">
                <button @click="showResetModal = false" class="flex-1 py-3 text-gray-400">ยกเลิก</button>
                <button @click="confirmReset" class="flex-1 py-3 bg-rose-600 text-white font-bold rounded-xl transition-all">ยืนยัน</button>
            </div>
        </div>
    </div>
</div>

<script>
    const { createApp, ref, reactive, onMounted, computed, watch } = Vue;

    createApp({
        setup() {
            const STORAGE_KEY = 'ken-redhood-v5-mobile-fix-final';
            const previewAreaRef = ref(null);
            const innerWrapperRef = ref(null);
            const containerWidth = ref(1024);
            const contentHeight = ref(0);
            const showToast = ref(false);
            const showResetModal = ref(false);
            let quill = null;

            const defaultData = {
                pic: 'https://images.unsplash.com/photo-1611601679655-7c8bc197f0c6?auto=format&fit=crop&q=80&w=400&h=400',
                picSz: 100, picPosX: 50, picPosY: 50,
                name: 'เรด (Red)',
                maxWidth: 1250,
                fontFamily: "'Niramit', sans-serif",
                fontSize: 18,
                edgeWidth: 120,
                edgeHeight: 120,
                note: 'โรลเพลย์ได้เลยครับ',
                msgHTML: '<p>เสียงย่ำเท้าลงบนใบไม้แห้งดังก้องไปทั่วอาณาบริเวณที่เงียบสงัด ฮู้ดสีแดงสดตัดกับความมืดมิดของป่าสนทึบสะบัดพลิ้วไปตามแรงลมที่พัดผ่าน...</p><p><br></p><p><em>*เธอหยุดชะงักฝีเท้า ค่อยๆ ลดตะกร้าลง สัญชาตญาณบางอย่างร้องเตือนให้ระวังภัยที่ซ่อนเร้นอยู่ในเงามืด*</em></p>'
            };

            const form = reactive({ ...defaultData });
            const savedData = localStorage.getItem(STORAGE_KEY);
            if (savedData) Object.assign(form, JSON.parse(savedData));
            watch(form, (val) => localStorage.setItem(STORAGE_KEY, JSON.stringify(val)), { deep: true });

            // Scaling Logic สำหรับ Preview Area
            const wrapperStyle = computed(() => {
                // Use user-configurable max width as the target for scaling
                const targetWidth = Math.max(1024, Number(form.maxWidth) || 1024);
                const margin = 40;
                const available = containerWidth.value - margin;
                const s = available < targetWidth ? available / targetWidth : 1;
                return {
                    transform: `scale(${s})`,
                    height: contentHeight.value > 0 ? (contentHeight.value * s) + 'px' : 'auto',
                    minWidth: '1024px',
                    maxWidth: targetWidth + 'px',
                    width: '100%',
                    ['--redhood-font-family']: form.fontFamily || "'Niramit', sans-serif",
                    ['--redhood-font-size']: (form.fontSize ? form.fontSize + 'px' : '18px'),
                    ['--redhood-edge-width']: (form.edgeWidth ? form.edgeWidth + 'px' : '120px'),
                    ['--redhood-edge-height']: (form.edgeHeight ? form.edgeHeight + 'px' : '120px'),
                    /* narrow variants are computed as 80% of main value for preview responsiveness */
                    ['--redhood-edge-width-narrow']: Math.round((form.edgeWidth || 120) * 0.8) + 'px',
                    ['--redhood-edge-height-narrow']: Math.round((form.edgeHeight || 120) * 0.8) + 'px'
                };
            });

            onMounted(() => {
                const updateDimensions = () => {
                    window.requestAnimationFrame(() => {
                        if (previewAreaRef.value) containerWidth.value = previewAreaRef.value.clientWidth;
                        if (innerWrapperRef.value) contentHeight.value = innerWrapperRef.value.offsetHeight;
                    });
                };
                
                const ro = new ResizeObserver(updateDimensions);
                if (previewAreaRef.value) ro.observe(previewAreaRef.value);
                if (innerWrapperRef.value) ro.observe(innerWrapperRef.value);

                quill = new Quill('#editor-container', {
                    theme: 'snow',
                    modules: { toolbar: [['bold', 'italic', 'underline', 'strike'], [{ 'color': [] }, { 'background': [] }], ['clean']] }
                });
                quill.root.innerHTML = form.msgHTML;
                quill.on('text-change', () => form.msgHTML = quill.root.innerHTML);
            });

            const copyToClipboard = () => {
                const cssLink = `<link href="https://ljus13.github.io/WotS/css/ken-code.css" rel="stylesheet">`;

                // Export: ให้กล่องมีขั้นต่ำ 1024px และ max ตามที่ผู้ใช้ตั้ง (แต่ไม่ทำให้มือถือ overflow)
                const exportMax = Number(form.maxWidth) || 1250;
                const fontFamilyExport = form.fontFamily || "'Niramit', sans-serif";
                const fontSizeExport = (form.fontSize ? form.fontSize + 'px' : '18px');
                const edgeW = (form.edgeWidth ? form.edgeWidth + 'px' : '120px');
                const edgeH = (form.edgeHeight ? form.edgeHeight + 'px' : '120px');
                const edgeWn = Math.round((form.edgeWidth || 120) * 0.8) + 'px';
                const edgeHn = Math.round((form.edgeHeight || 120) * 0.8) + 'px';
                const scalingStyle = `<style>.ken-redhood26-box{width:100% !important;min-width:1024px !important;max-width:${exportMax}px !important;min-height:1024px !important;box-sizing:border-box;--redhood-font-family:${fontFamilyExport};--redhood-font-size:${fontSizeExport};--redhood-edge-width:${edgeW};--redhood-edge-height:${edgeH};--redhood-edge-width-narrow:${edgeWn};--redhood-edge-height-narrow:${edgeHn}}@media(max-width:1024px){.ken-redhood26-box{min-width:0 !important;width:100% !important}}</style>`;

                const notes = form.note.trim() !== '' ? `<div class="ken-redhood26-notes"><div class="ken-redhood26-notes-bg-icon">&ldquo;</div><div class="ken-redhood26-notes-inner"><svg class="ken-redhood26-notes-svg" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg><div><span class="ken-redhood26-notes-title">หมายเหตุ:</span><span class="ken-redhood26-notes-desc">${form.note}</span></div></div></div>` : '';

                const rawHtml = `${cssLink}${scalingStyle}<div class="ken-redhood26-box"><div class="ken-redhood26-inner-header"><div class="ken-redhood26-profile-section"><span class="ken-redhood26-name">${form.name}</span><div class="ken-redhood26-avatar-wrapper"><div class="ken-redhood26-avatar-glow"></div><div class="ken-redhood26-avatar" style="background: url('${form.pic}') ${form.picPosX}% ${form.picPosY}% / ${form.picSz}% no-repeat;"></div></div></div></div><div class="ken-redhood26-glass-panel"><div class="ken-redhood26-content ql-editor">${form.msgHTML}</div>${notes}</div></div><a href="https://discord.com/users/306461697470627840" target="_blank" class="ken-redhood26-credit" style="display:block;margin:0 auto;transform-origin:top center;max-width:1024px;width:100%;"></a>`;
                
                const finalCode = rawHtml.replace(/[\r\n]+/g, '').replace(/>\s+</g, '><').trim();
                const el = document.createElement('textarea');
                el.value = finalCode; document.body.appendChild(el); el.select();
                document.execCommand('copy'); document.body.removeChild(el);

                showToast.value = true;
                setTimeout(() => showToast.value = false, 3000);
            };

            const confirmReset = () => { localStorage.removeItem(STORAGE_KEY); window.location.reload(); };

            return { form, previewAreaRef, innerWrapperRef, wrapperStyle, showToast, showResetModal, copyToClipboard, promptReset: () => showResetModal.value = true, confirmReset };
        }
    }).mount('#app');
</script>
</body>
</html>